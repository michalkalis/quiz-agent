{% extends "base.html" %}

{% block title %}Statistics - Quiz Question Manager{% endblock %}

{% block content %}
<div class="stats">
    <div class="stat-card">
        <h3>Total Questions</h3>
        <div class="value">{{ stats.total }}</div>
    </div>
    <div class="stat-card">
        <h3>Pending Review</h3>
        <div class="value" style="color: #f39c12;">{{ stats.pending_review }}</div>
    </div>
    <div class="stat-card">
        <h3>Approved</h3>
        <div class="value" style="color: #27ae60;">{{ stats.approved }}</div>
    </div>
    <div class="stat-card">
        <h3>Rejected</h3>
        <div class="value" style="color: #e74c3c;">{{ stats.rejected }}</div>
    </div>
    <div class="stat-card">
        <h3>Needs Revision</h3>
        <div class="value" style="color: #a29bfe;">{{ stats.needs_revision }}</div>
    </div>
    <div class="stat-card">
        <h3>Avg Quality Score</h3>
        <div class="value" style="font-size: 28px;">
            {% if stats.avg_quality_score %}
                {{ "%.2f"|format(stats.avg_quality_score) }}/5.0
            {% else %}
                -
            {% endif %}
        </div>
    </div>
</div>

<div class="card">
    <h2>Review Progress</h2>
    <div style="margin-top: 20px;">
        {% set reviewed = stats.approved + stats.rejected + stats.needs_revision %}
        {% set review_percentage = (reviewed / stats.total * 100) if stats.total > 0 else 0 %}

        <div style="background: #ecf0f1; height: 40px; border-radius: 4px; overflow: hidden; position: relative;">
            <div style="background: #27ae60; height: 100%; width: {{ review_percentage }}%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                {{ "%.0f"|format(review_percentage) }}%
            </div>
        </div>
        <p style="margin-top: 10px; color: #7f8c8d;">
            {{ reviewed }} of {{ stats.total }} questions reviewed
        </p>
    </div>
</div>

<div class="card">
    <h2>Quality Breakdown</h2>
    <table>
        <thead>
            <tr>
                <th>Metric</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Approval Rate</td>
                <td>
                    {% if reviewed > 0 %}
                        {{ "%.1f"|format(stats.approved / reviewed * 100) }}%
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Rejection Rate</td>
                <td>
                    {% if reviewed > 0 %}
                        {{ "%.1f"|format(stats.rejected / reviewed * 100) }}%
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Questions Needing Work</td>
                <td>{{ stats.needs_revision }}</td>
            </tr>
            <tr>
                <td>Production-Ready Questions</td>
                <td style="font-weight: 700; color: #27ae60;">{{ stats.approved }}</td>
            </tr>
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Next Steps</h2>
    <div style="line-height: 2;">
        {% if stats.pending_review > 0 %}
            <p>✓ You have <strong>{{ stats.pending_review }} questions</strong> waiting for review</p>
            <a href="/web/review" class="btn btn-success">Start Reviewing</a>
        {% else %}
            <p>✓ All questions have been reviewed!</p>
        {% endif %}

        {% if stats.approved < 100 %}
            <p style="margin-top: 15px;">✓ Goal: Reach <strong>100 approved questions</strong> for production</p>
            <p style="margin-left: 20px; color: #7f8c8d;">
                Progress: {{ stats.approved }} / 100 ({{ "%.0f"|format(stats.approved / 100 * 100) }}%)
            </p>
        {% else %}
            <p style="margin-top: 15px; color: #27ae60;">✓ Goal reached! You have {{ stats.approved }} approved questions</p>
        {% endif %}

        {% if stats.approved >= 50 and stats.approved < 500 %}
            <p style="margin-top: 15px;">✓ Next milestone: <strong>500 questions</strong> for fine-tuning</p>
            <p style="margin-left: 20px; color: #7f8c8d;">
                Progress: {{ stats.approved }} / 500 ({{ "%.0f"|format(stats.approved / 500 * 100) }}%)
            </p>
        {% elif stats.approved >= 500 %}
            <p style="margin-top: 15px; color: #27ae60;">✓ Ready for fine-tuning! You have {{ stats.approved }} questions</p>
        {% endif %}
    </div>
</div>
{% endblock %}
